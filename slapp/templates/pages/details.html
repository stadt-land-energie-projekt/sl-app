{% extends "base.html" %}

{% load humanize %}

{% block content %}
  <div class="container">
    <h1 class="mt-4">Detailansicht</h1>
    <div class="row mt-4">
      <div class="col-4">
        <form autocomplete="off">
          <input type="text"
                 hx-post="{% url 'explorer:search-municipality' %}"
                 hx-target='#results'
                 hx-trigger="keyup changed delay:500ms"
                 hx-vals='{"param_string": "{{ request.get_full_path }}"}'
                 name="search"
                 class="form-control mr-2"
                 placeholder="Gemeinden suchen & hinzufügen" />
        </form>
        <div id="results"></div>
      </div>
    </div>
    {% if municipalities %}
      <div class="row mt-4 g-0" id="municipality-results">
        <div class="col-3">
          <ul class="list-group rounded-0 text-truncate">
            <li class="list-group-item fw-bold bg-secondary text-white">Gemeinde</li>
            <li class="list-group-item">Fläche</li>
            <li class="list-group-item fw-bold">erneuerbare Stromerzeugung</li>
            <li class="list-group-item">Freiflächen-PV</li>
            <li class="list-group-item">Dachflächen-PV</li>
            <li class="list-group-item">Windkraft</li>
            <li class="list-group-item">Biomasse</li>
            <li class="list-group-item">Wasserkraft</li>
            <li class="list-group-item fw-bold">Stromspeicher</li>
            <li class="list-group-item">Speicherkapazität</li>
            <li class="list-group-item fw-bold">Wärmegewinnung (KWK)</li>
            <li class="list-group-item">thermische Leistung</li>
            <li class="list-group-item">elektrische Leistung</li>
            <li class="list-group-item fw-bold">Energiebedarf (errechnet)</li>
            <li class="list-group-item">Strombedarf</li>
            <li class="list-group-item">Wärmebedarf</li>
          </ul>
        </div>
        {% for municipality in municipalities %}
          <div class="col-2 text-truncate">
            <ul class="list-group rounded-0">
              <li class="list-group-item text-end fw-bold bg-secondary text-white">
                {{ municipality.name }}
                <a class="icon-link text-white"
                   href="{% url 'explorer:details' %}?{% for municipality_ids in municipalities %}{% if municipality_ids.id != municipality.id %}id={{ municipality_ids.id }}&{% endif %}{% endfor %}">
                  <svg xmlns="http://www.w3.org/2000/svg"
                       width="16"
                       height="16"
                       fill="currentColor"
                       class="bi bi-x-circle-fill"
                       viewBox="0 0 16 16">
                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293z" />
                  </svg>
                </a>
              </li>
              <li class="list-group-item text-end">{{ municipality.area_rounded|intcomma }}</li>
              <li class="list-group-item text-end fw-bold">{{ municipality.total_net|intcomma }}</li>
              <li class="list-group-item text-end">{{ municipality.pvground_net|intcomma }}</li>
              <li class="list-group-item text-end">{{ municipality.pvroof_net|intcomma }}</li>
              <li class="list-group-item text-end">{{ municipality.wind_net|intcomma }}</li>
              <li class="list-group-item text-end">{{ municipality.biomass_net|intcomma }}</li>
              <li class="list-group-item text-end">{{ municipality.hydro_net|intcomma }}</li>
              <li class="list-group-item fw-bold">&nbsp</li>
              <li class="list-group-item text-end">{{ municipality.storage_net|intcomma }}</li>
              <li class="list-group-item fw-bold">&nbsp</li>
              <li class="list-group-item text-end">{{ municipality.kwk_th_net|intcomma }}</li>
              <li class="list-group-item text-end">{{ municipality.kwk_el_net|intcomma }}</li>
              <li class="list-group-item fw-bold">&nbsp</li>
              <li class="list-group-item fw-bold">&nbsp</li>
              <li class="list-group-item fw-bold">&nbsp</li>
            </ul>
          </div>
        {% endfor %}
        <div class="col-1">
          <ul class="list-group rounded-0">
            <li class="list-group-item bg-secondary text-white">Einheit</li>
            <li class="list-group-item">km²</li>
            <li class="list-group-item fw-bold">kW</li>
            <li class="list-group-item">kW</li>
            <li class="list-group-item">kW</li>
            <li class="list-group-item">kW</li>
            <li class="list-group-item">kW</li>
            <li class="list-group-item">kW</li>
            <li class="list-group-item fw-bold">&nbsp</li>
            <li class="list-group-item">kWh</li>
            <li class="list-group-item fw-bold">&nbsp</li>
            <li class="list-group-item">kW</li>
            <li class="list-group-item">kW</li>
            <li class="list-group-item fw-bold">&nbsp</li>
            <li class="list-group-item">kWh</li>
            <li class="list-group-item">kWh</li>
          </ul>
        </div>
      </div>
      <a href="{% url 'explorer:details-csv' %}?{% for municipality_ids in municipalities %}id={{ municipality_ids.id }}&{% endfor %}">Als CSV herunterladen</a>
      <div class="mt-4">
        <div class="wizard__next">
          <button hx-post="{% url 'explorer:esm_mode' %}"
                  hx-target="body"
                  type="submit"
                  id="menu_next_btn"
                  class="btn btn-primary">
            <span>Mit Energiesystemoptimierung für diese
            Gemeinden beginnen</span>
          </button>
        </div>
      </div>
    {% else %}
      <div class="mt-3">Fügen Sie zunächst Gemeinden für die Optimierung hinzu.</div>
    {% endif %}
  </div>
{% endblock content %}
