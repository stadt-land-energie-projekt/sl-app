{% extends "base.html" %}

{% load static %}

{% block content_no_sidebar %}
<main class="results">
  <div class="results__container">
    <header id="header">
      <h1>Zentrale Ergebnisse</h1>
      <p>Wähle eine Case Study</p>
    </header>
    <div class="results__selection">
      <div class="results__region-container">
        <div class="results__top-row">
          <img class="results__region-image" src="{% static 'images/Oderland-Spree.png' %}" alt="Karte Oderland-Spree Verbund" />
          <h2>Oderland-Spree (Verbund)</h2>
        </div>
        <div class="results__cta-row">
          <button onclick="showHiddenDiv('verbu', this)">Auswählen</button>
        </div>
      </div>
      <div class="results__region-container">
        <div class="results__top-row">
          <img class="results__region-image" src="{% static 'images/Oderland-Spree-single.png' %}" alt="Karte Oderland-Spree Einzeln" />
          <h2>Oderland-Spree (Einzeln)</h2>
        </div>
        <div class="results__cta-row">
          <button onclick="showHiddenDiv('einzeln', this)">Auswählen</button>
        </div>
      </div>
      <div class="results__region-container">
        <div class="results__top-row">
          <img class="results__region-image" src="{% static 'images/Kiel.png' %}" alt="Karte Kiel" />
          <h2>Kiel</h2>
        </div>
        <div class="results__cta-row">
          <button class="results__button" onclick="showHiddenDiv('kiel', this)">Auswählen</button>
        </div>
      </div>
    </div> 
  </div>
  <div class="hidden-div">
    <section class="bg-light">
      <div class="results__container">
        <div class="results__tabs">
          <button class="tab-button active" data-tab="exchange">Austausch</button>
          <button class="tab-button" data-tab="basic-solution">Basislösung</button>
          <button class="tab-button" data-tab="sensitivity">Sensitivitäten</button>
          <button class="tab-button" data-tab="alternatives">Alternative Lösungen erkunden</button>
        </div>
        <div class="results__tabs-content">
          <div id="exchange" class="tab-content tab-content--exchange active">
            <div>
              <div id="electricity-chart"></div>
              <div id="hydrogen-chart"></div>
            </div>
          </div>
          <div class="tab-content tab-content--basic" id="basic-solution">
            <div id="basic-charts">
              <div>
                <div id="basic-electricity" class="chart-container"></div>
                <div id="basic-heat" class="chart-container"></div>
              </div>
              <div>
                <div id="basic-capacity" class="chart-container"></div>
                <div id="basic-costs" class="chart-container"></div>
              </div>
            </div>
            {% include 'pages/partials/ranges_chart_table.html' with divergence=1 %}
          </div>
          <div class="scope-chart">
            <div class="flex-container">
              <div class="plus-minus-container">
                <img src="{% static 'images/icons/plus_minus.svg' %}"
                     alt="plus-minus icon"
                     class="plus-minus-icon" />
                2 %
              </div>
              Wenn Sie innerhalb von <span>+/- 2% der Gesamtkosten</span> bleiben möchten, ergeben sich für die Technologien
              folgende Spielräume:
            </div>
            {% include 'pages/partials/ranges_chart_table.html' with divergence=2 %}
          </div>
        </div>
      </div>
    </section>
  </div>
  <div>
      <a href="{{ home_url }}" class="btn btn-primary mt-3">Zur Hauptseite</a>
      <a href="{{ added_value_url }}" class="btn btn-primary mt-3">Zum Wertschöpfungsrechner</a>
  </div>
</main>
  
{% endblock content_no_sidebar %}
{% block javascript %}
  {{ block.super }}
  <script src="{% static 'js/results.js' %}" defer></script>
{% endblock javascript %}
{% block inline_javascript %}
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const buttons = document.querySelectorAll(".results .tab-button");
      const contents = document.querySelectorAll(".results .tab-content");

      buttons.forEach((button) => {
        button.addEventListener("click", () => {
          // Remove active class
          buttons.forEach((btn) => btn.classList.remove("active"));
          contents.forEach((content) => content.classList.remove("active"));

          // Add active class
          button.classList.add("active");
          const activeTab = document.getElementById(button.dataset.tab);
          activeTab.classList.add("active");

          // Trigger chart resize for all charts inside the activated tab, otherwise the charts won't be displayed correctly
          const charts = activeTab.querySelectorAll(".chart-container");
          charts.forEach((container) => {
            const chart = echarts.getInstanceByDom(container);
            if (chart) chart.resize();
          });
        });
      });
    });

    // Toggle content about MGA
    function toggleMoreInfo() {
      const box = document.getElementById("more-info-box");
      const arrow = document.getElementById("info-arrow");

      box.classList.toggle("open");

      const isOpen = box.classList.contains("open");

      arrow.innerHTML = isOpen
        ? `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-up" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708z"/>
          </svg>`
        : `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708"/>
          </svg>`;
    }


    // Tabs between 1% and 2% scope
    function toggleScope(id) {
      document.querySelectorAll('.scope-wrapper').forEach(div => div.classList.remove('active'));
      document.getElementById(id).classList.add('active');

      document.querySelectorAll('.toggle-button').forEach(btn => btn.classList.remove('active'));
      const idx = id === 'scope-1' ? 0 : 1;
      document.querySelectorAll('.toggle-button')[idx].classList.add('active');
    }
  </script>
{% endblock inline_javascript %}
